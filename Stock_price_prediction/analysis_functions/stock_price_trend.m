function output_results = stock_price_trend(data)  % modified 20190101-17:33
% clear;
% close all
%        %  data=[3.07	3.03	2.96	2.95	3.02	2.96	2.97	2.89	2.9	2.84	2.85	2.85	2.83	2.81	2.84	2.82	2.81	2.81	2.8	2.79	2.79	2.79	2.84	2.84	2.85	2.85	2.86	2.87	2.87	2.84	2.85	2.88	2.86	2.89	2.86	2.88	2.9	2.91	2.9	2.94	2.92	2.91	2.91	2.91	2.95	3.01	2.99	3.03	3	3.14	3.06	3.1	3.12	3.16	3.13	3.14	3.14	3.11	3.11	3.1	3.1	3.15	3.13	3.15	3.12	3.11	3.1	3.1	3.12	3.13	3.07	3.04	3.02	2.99	3.03	3.08	3.05	3.07	3.08	3.01	3.03	3.09	3.09	3.1	3.11	3.12	3.17	3.15	3.24	3.23	3.13	3.05	3.06	3.07	3	3.02	3	2.99	3.02	3	2.92	2.93	2.93	2.96	2.95	2.91	2.91	2.91	2.91	2.94	2.93	2.94	2.93	2.93	2.96	2.96	2.99	2.99	2.19	2.15	2.14	2.15	2.16	2.19	2.19	2.17	2.15	2.18	2.17	2.18	2.18	2.19	2.2	2.19	2.17	2.17	2.19	2.18	2.2	2.21	2.19	2.24	2.22	2.23	2.29	2.38	2.38	2.33	2.32	2.42	2.39	2.35	2.48	2.53	2.54	2.51	2.49	2.47	2.52	2.5	2.55	2.81	2.77	2.89	2.92	2.94	3.05	2.96	2.99	2.91	2.67	2.74	2.75	2.7	2.72	2.67	2.73	2.7	2.65	2.64	2.7	2.72	2.72	2.8	2.79	2.89	2.9	2.86	2.88	2.82	2.8	2.84	2.9	2.89	2.83	2.76	2.76	2.71	2.73	2.71	2.7	2.66	2.7	2.72	2.7	2.7	2.72	2.69	2.67	2.67	2.66	2.66	2.64	2.58	2.51	2.56	2.56	2.61	2.63	2.65	2.68	2.61	2.6	2.63	2.59	2.54	2.61	2.67	2.68	2.66	2.65	2.69	2.68	2.64	2.61	2.54	2.57	2.56	2.59	2.54	2.57	2.53	2.58	2.64	2.6	2.62	2.65	2.55	2.55	2.52	2.55	2.61	2.59	2.59	2.57	2.54	2.54	2.55	2.51	2.52	2.51	2.41	2.42	2.43	2.47	2.46	2.5	2.51	2.5	2.5	2.54	2.55	2.52	2.49	2.5	2.44	2.45	2.46	2.49	2.47	2.5	2.49	2.49	2.55	2.52	2.54	2.52	2.48	2.44	2.5	2.52	2.43	2.43	2.42	2.28	2.3	2.31	2.32	2.36	2.35	2.37	2.35	2.37	2.36	2.34	2.32	2.34	2.32	2.33	2.33	2.34	2.31	2.32	2.3	2.29	2.27	2.27	2.26	2.26	2.15	2.17	2.19	2.17	2.19	2.18	2.19	2.17	2.18	2.13	2.09	2.12	2.11	2.1	2.08	2.04	2.04	2.02	2.03	2.03	2.02	2.02	2.02	2.01	2.02	2.01	2.01	2.01	2.06	2.06	2.02	2.01	2.01	1.81	1.76	1.68	1.71	1.69	1.68	1.68	1.68	1.7	1.69	1.7	1.7	1.69	1.71	1.7	1.53	1.51	1.61	1.6	1.54	1.55	1.52	1.52	1.55	1.52	1.53	1.54	1.49	1.49	1.52	1.53	1.51	1.53	1.54	1.55	1.54	1.52	1.54	1.55	1.57	1.61	1.64	1.65	1.71	1.67	1.67	1.63	1.61	1.58	1.58	1.63	1.66	1.67	1.65	1.65	1.63	1.59	1.58	1.55	1.57	1.58	1.56	1.56	1.56	1.58	1.57	1.56	1.52	1.51	1.52	1.53	1.51	1.5	1.49	1.49	1.5	1.49	1.49	1.5	1.46	1.48	1.49	1.5	1.51	1.49	1.52	1.51	1.66	1.66	1.66	1.62	1.52	1.56	1.57	1.54	1.54	1.47	1.5	1.57	1.52	1.53	1.53	1.55	1.52	1.58	1.62	1.59	1.62	1.6	1.59	1.59	1.6	1.57	1.6	1.65	1.67	1.68	1.65	1.67	1.62	1.62	1.62	1.57	1.58	1.57	1.58	1.56	1.53	1.57	1.58	1.56	1.54	1.54	1.53	1.54	1.54	1.58	1.56	1.57	1.56	1.55	1.55	1.55	1.54	1.52	1.51	1.47	1.48	1.48];
          %data=[	11.08	11.47	11.47	11.39	11.34	11.34	11.48	11.59	11.56	11.73	11.7	11.44	11.1	11.12	11.06	10.72	10.79	10.83	10.71	10.72	10.7	10.62	10.59	10.59	10.52	10.6	10.55	10.55	10.34	10.05	9.92	9.7	9.68	9.76	9.76	9.85	9.83	9.62	9.18	9.28	9.31	9.32	9.58	9.38	9.27	9.2	9.16	9.08	9.08	9.04	9	9.22	9.33	9.38	9.41	9.46	9.65	9.5	9.52	9.58	9.5	9.38	9.22	9.33	9.73	9.62	9.58	9.6	9.7	9.67	9.59	9.52	9.54	9.54	9.62	9.68	9.66	9.6	9.6	9.26	9.08	9.1	8.28	9.04	9.05	8.78	9.19	9.17	9.23	9.47	9.48	9.47	9.41	9.3	9.37	9.45	9.31	9.35	9.3	9.36	9.42	9.53	9.53	9.29	9.09	9.21	9.34	9.2	9.15	9.11	8.77	8.97	9	9.06	9.52	9.41	9.56	9.43	9.35	9.26	9.2	9.41	9.43	9.33	9.34	9.18	9.5	9.47	9.5	9.56	9.64	9.49	9.42	9.39	9.36	9.44	9.42	9.6	9.57	9.69	9.71	9.52	9.22	9.29	9.17	9.04	9.08	9.22	9.13	8.98	9.01	8.97	8.81	8.9	8.84	8.96	8.97	8.83	8.82	8.76	8.74	8.64	8.64	8.65	8.53	8.11	7.92	7.61	7.92	7.92	7.89	7.75	7.67	7.62	7.61	7.74	7.65	7.63	7.5	7.34	7.17	7.25	7.2	7.04	6.97	6.94	6.81	6.83	6.73	6.67	6.78	6.8	6.94	6.91	6.91	6.83	6.77	6.75	6.75	6.88	6.77	6.77	7.03	6.68	6.53	6.53	6.41	6.4	6.4	6.45	6.44	6.4	6.38	6.32	6.4	6.4	6.42	6.38	6.26	6.12	6.37	6.24	6.21	6.15	6.06	6.07	6.07	6.23	6.4	6.5	6.47	6.3	6.33	6.33	6.29	6.42	6.29	6.29	6.1	6.34	6.19	6.17	6.31	6.05	6.13	6.09	6.02	5.98	5.78	5.77	5.86	5.8	5.8	5.74	5.75	5.87	5.91	6.07	6.07	6.13	6.08	6.04	6.14	6.09	6.04	6.43	6.35	6.6	6.83	7.51	7.07	6.9	6.9	6.78	6.32	6.34	6.97	7.14	7.05	7.21	7.38	7.37	7.05	7.02	7.39	7.23	7.15	7.08	7.08	6.94	7.03	7.08	6.72	6.76	6.7	6.76	6.52	6.52	6.2	6.52];
% data=data(1:272);

         [data_r,data_c]=size(data);
         
         if data_r ~=1 || ~isempty(find(data==0,1) )
             error('Invalid argument provided. The length of the data shoulb be 4 and nonzero');
         end
         if data_c <100 %数据小于100，不考虑
             output_results = zeros(1,5);
             return;
         end
       
        output_results=zeros(1,5);

%% 近400天内是否出息除权
       
            for j=2:1:data_c
    
                 para=(data(j-1)-data(j))/data(j);
              
                 if para > 0.21
                     output_results(1)=1;
                     break;
                 end
            end   
                    
 %%                 
         data_day5 =zeros(data_r,data_c);        
         data_day30=zeros(data_r,data_c);
                for i = 1:data_c  %(data_c>=100) 计算K5和K30
                     if i<5
                         data_day5(i)  = sum(data(1:i))/i; 
                         data_day30(i) = sum(data(1:i))/i;
                     elseif i<30
                         data_day5(i)  = sum(data(i-4:i))/5; 
                         data_day30(i) = sum(data(1:i))/i;
                     else
                         data_day5(i)  = sum(data(i-4:i))/5; 
                         data_day30(i) = sum(data(i-29:i))/30;   
                     end    
                end           
  %%            
        days=data_day30 - data_day5;
   %% 非常有必要对数据进行平滑
     
     for j=1:data_c   %将曲线平滑，左右3个点再次平均一次
           
           if j<4
               days(j)=sum(days(1:j+3))/(j+3);
           elseif j>data_c-4 %396
               days(j)=sum(days(j-3:data_c))/(data_c-j+4);
           else
               days(j)=sum(days(j-3:j+3))/7;
           end
           
     end
     for j=1:data_c   %将曲线再次平滑，左右3个点再次平均一次
           
           if j<4
               days(j)=sum(days(1:j+3))/(j+3);
           elseif j>data_c-4 %396
               days(j)=sum(days(j-3:data_c))/(data_c-j+4);
           else
               days(j)=sum(days(j-3:j+3))/7;
           end
           
     end
     for j=1:data_c   %将曲线再次平滑，左右3个点再次平均一次
           
           if j<4
               days(j)=sum(days(1:j+4))/(j+3);
           elseif j>data_c-4 %396
               days(j)=sum(days(j-3:data_c))/(data_c-j+4);
           else
               days(j)=sum(days(j-2:j+4))/7;
           end
           
     end
     
     %% 求days的斜率
     
     slope=zeros(data_r,data_c);
     for j=2:data_c   %将曲线再次平滑，左右3个点再次平均一次
           slope(j)=days(j)-days(j-1);
     end
       
     
     
     %% 找到days的零点
     numbers_of_0=1;
     
      for j=1:data_c-1   %
          
          if days(j)*days(j+1) <0
              points( numbers_of_0)=j;
              numbers_of_0= numbers_of_0+1;
          end
          
      end
     
 %%     
%       points=[1
%       
%       
%  for i=1:length(points)
%     
%     if da
%     
%     
%                                                                               
% end
     
 %%    
%100天，300天，400天
         
       if 100<data_c && data_c<=300    %如果数据长度大于100小于300
            
            days_100=days(data_c-100:data_c);
            output_results(2)= (sum(days_100>0.00));  
            output_results(3:4)= length(days(days>0)); 
        else
            days_100=days(data_c-100:data_c);
            output_results(2)= (sum(days_100>0.00));%100天
            
            days_300=days(data_c-300:data_c);
            output_results(3)= (sum(days_300>0.00));%300天
            
            output_results(4)= length(days(days>0));%400天  
       end
       
       
       
%% 最近的最大跌幅

        max_price=max(data);
        output_results(5)=(max_price-data(1,data_c))/max_price; %到今天为止，股价最大跌了多少,最好是跌了很多
   
%% 画图

                                                                            figure
                                                                            plot(data)
                                                                            hold on
                                                                            plot(data_day5)
                                                                            hold on
                                                                            plot(data_day30)
                                                                           hold on
                                                                           plot(days)
                                                                           hold on
                                                                           plot(zeros(data_r,data_c))
                                                                           
                                                                           for i=1:length(points)
                                                                               plot( linspace(points(i),points(i),50) ,linspace(0,data(points(i)),50)  )
                                                                           end
                                                                               
  
end